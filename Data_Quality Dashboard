


<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <!-- Chart.js (UMD build) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js"></script>
    <!-- Treemap plugin (UMD) - must come AFTER chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@3.1.0/dist/chart-js-treemap.min.js"></script>

    <style>
        .dq-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .dq-table td {
            border: 1px solid #e1e1e8;
            padding: 8px 12px;
        }
        .dq-table tr:first-child td {
            background: #f0f0f5;
            font-weight: 600;
        }
    </style>

    <style>
        .kpi-row {
            display: flex;
            gap: 16px;
            margin: 12px auto 20px auto;
            max-width: 1100px;
        }
        .kpi-card {
            flex: 1;
            background: #f7f7fa;
            border: 1px solid #e1e1e8;
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 1px 20px rgba(0, 0, 0, 0.05);
        }
        .kpi-title {
            color: #555;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.6px;
        }
        .kpi-value {
            border-top: 4px solid #4B2E83;
            border-radius: 8px 8px 0 0;
        }
    </style>
</asp:Content>

<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder1" runat="server">

    <asp:MultiView ID="myDQ" runat="server">
        <asp:View ID="myboard" runat="server">
            <asp:Table ID="Table1" runat="server" CssClass="dq-table" />
            <div class="kpi-row">
                <div class="kpi-card kpi-accent">
                    <div class="kpi-title">Total Tables</div>
                    <div class="kpi-value">
                        <asp:Label ID="lblTotalTables" runat="server" Text="0"></asp:Label>
                    </div>
                </div>

                <div class="kpi-card kpi-accent">
                    <div class="kpi-title">Total Records</div>
                    <div class="kpi-value">
                        <asp:Label ID="lblTotalRecords" runat="server" Text="0"></asp:Label>
                    </div>
                </div>

                <div class="kpi-card kpi-accent">
                    <div class="kpi-title">Total Schemas</div>
                    <div class="kpi-value">
                        <asp:Label ID="lblTotalSchemas" runat="server" Text="0"></asp:Label>
                    </div>
                </div>
            </div>

            <canvas id="treemapChart" style="width:100%; height:500px;"></canvas>

            <script>
                // VB.NET injected JSON
                var chartData = <%= schemaJson %>;

                const treemapValues = chartData.map(s => ({
                    label: `[${s.Schema}]`,
                    value: Number(s.RowCount) || 0
                }));

                const canvasEL = document.getElementById('treemapChart');
                if (canvasEL && typeof Chart !== 'undefined') {
                    new Chart(canvasEL, {
                        type: 'treemap',
                        data: {
                            datasets: [{
                                tree: treemapValues,
                                key: 'value',
                                groups: ['label'],
                                spacing: 0.5,
                                borderWidth: 1,
                                borderColor: '#fff',
                                backgroundColor: function(ctx) {
                                    const value = ctx.dataset.data[ctx.dataIndex].v;
                                    const alpha = Math.min(0.7, 0.3 + (value / 1000000));
                                    return `rgba(255, 75, 75, ${alpha})`;
                                },
                                labels: {
                                    display: true,
                                    formatter: function(ctx) {
                                        return `${ctx.raw.label} (${ctx.raw.value})`;
                                    }
                                }
                            }]
                        }
                    });
                } else {
                    console.error('Canvas element not found or Chart.js not loaded.');
                }
            </script>

        </asp:View>
    </asp:MultiView>

</asp:Content>